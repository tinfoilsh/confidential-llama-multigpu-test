shim-version: v0.1.1@sha256:fcd0ba0ea3f0ca26d92595ea90f28308cfba819e3243925892e6c8f21eb1397d
cvm-version: 0.4.1
cpus: 32
memory: 524288
gpus: full
vllm: false

models:
  - name: "llama3-3-70b-int4"
    repo: "lambdalabs/Llama-3.3-70B-Instruct-AWQ-4bit@a70257cf10f368114a66115c315def76a1227e26"
    mpk: "06002d4871dbd882fc8b4c385e5181fdd85615e514f4efca3b6b3a3a774a36d2_39785426944_58b5d994-b471-58c9-8058-d224be115e1a"

containers:
  - name: "llama3-3-70b-int4-tp2"
    image: ""
    args: [
      "--runtime", "nvidia",
      "--gpus", "'\"device=0,1\"'",
      "--ipc", "host",
      "vllm/vllm-openai:v0.9.2",
      "--model", "/tinfoil/mpk/mpk-06002d4871dbd882fc8b4c385e5181fdd85615e514f4efca3b6b3a3a774a36d2",
      "--tensor-parallel-size", "2",
      "--max-model-len", "32768",
      "--served-model-name", "llama3-3-70b-int4-tp2",
      "--port", "8001",
      "--quantization", "awq_marlin"
    ]
  - name: "llama3-3-70b-int4"
    image: ""
    args: [
      "--runtime", "nvidia",
      "--gpus", "'\"device=2\"'",
      "--ipc", "host",
      "vllm/vllm-openai:v0.9.2",
      "--model", "/tinfoil/mpk/mpk-06002d4871dbd882fc8b4c385e5181fdd85615e514f4efca3b6b3a3a774a36d2",
      "--tensor-parallel-size", "1",
      "--max-model-len", "32768",
      "--served-model-name", "llama3-3-70b-int4",
      "--port", "8002",
      "--quantization", "awq_marlin"
    ]
  - name: "model-router"
    image: ""
    args: [
      "ghcr.io/tinfoilsh/model-router:0.0.1",
      "/app/bin", "-m", "llama3-3-70b-int4-tp2_8001,llama3-3-70b-int4_8002",
    ]

shim:
  listen-port: 443
  upstream-port: 8087
  publish-attestation: false
  tls-challenge: dns
  tls-mode: self-signed  
  paths:
    - /v1/chat/completions
    - /metrics
  origins:
    - https://tinfoil.sh
    - https://chat.tinfoil.sh
    - http://localhost:3000
